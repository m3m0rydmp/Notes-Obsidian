CSRF is a web security vulnerability that allows an attacker to induce users to perform actions that they do not intend to perform. It allows an attacker to partly circumvent the same origin policy, which is designed to prevent different websites from interfering with each other.

## Impact
A successful CSRF attack allows attacker to cause the victim to carry out an action unintentionally. For example, this might be to change the email address on their account, to change their password, or to make a funds transfer. Depending on the nature of the action, the attacker might be able to gain full control over the user's account. If the compromised user has a privileged role within the application, then the attacker might be able to take full control of all the application's data and functionality.

## How Does it Work?
* **A Relevant Action** - There is an action within the application that the attacker has a reason to induce. This might be a privileged action (such as modifying permissions for other users) or any action on user-specific data (such as changing the user's own password).
* **Cookie-Based Session Handling** - Performing the action involves issuing one or more HTTP requests, and the application relies solely on session cookies to identify the user who has made the requests. There is no other mechanism in place for tracking sessions or validating user requests.
* **No Unpredictable Request Parameters** - The requests that perform the action do not contain any parameters whose values the attacker cannot determine or guess. For example, when causing a user to change their password, the function is not vulnerable if an attacker needs to know the value of the existing password.

**IN SIMPLE TERMS** A website is vulnerable to **CSRF** if it uses a **Session-Based Authentication**, basically any form of automatic authentication (cookies, HTTP Basic Auth, etc.) and lacks CSRF protection. All it takes is for an attacker to trick the victim, the website could be any content. As long as the attacker knows that the website is vulnerable to CSRF if automatically executes a request to the vulnerable website. If you by chance is a user and is logged in on the vulnerable website, your stored session cookie will be automatically sent to make a request in the vulnerable website in the background. The authentication sent to the vulnerable website will be your cookie, and it will execute the actions performed.

# CSRF Vulnerability with No Defences
[LAB: CSRF vulnerability with no defences](https://portswigger.net/web-security/csrf/lab-no-defenses)
The goal of this lab is to craft a CSRF HTML payload, and deliver the exploit to the victim. As an attacker, you need to find a function that do some submit actions. In this lab, the **update email** is the action you need to intercept. 

When using a **BurpSuite Professional** it is easy to craft a CSRF PoC. 
![](../../assets/PortSwigger%20Labs/CSRF/Pasted%20image%2020260205174457.png)
After clicking the **update email** button, intercept the request in your BurpSuite. Right-click on the request, then select **Engagement tools** -> **Generate CSRF POC**.
![](../../assets/PortSwigger%20Labs/CSRF/Pasted%20image%2020260205174651.png)
Remember to enable the **Include auto-submit script** so it will be included in the CSRF HTML. Then copy the HTML
![](../../assets/PortSwigger%20Labs/CSRF/Pasted%20image%2020260205174725.png)
Then go to your exploit server and paste the HTM CSRF POC in the **Body** field. Optionally, change the `value=` property so it doesn't match your own (changing the name is enough). Then click the **Store** button, then **Deliver the exploit to victim,** optionally, you can view the exploit to see if it's working.

## CSRF Where Token Validation Depends on Request Method
[LAB: CSRF where token validation depends on request method](https://portswigger.net/web-security/csrf/bypassing-token-validation/lab-token-validation-depends-on-request-method)
The goal of this lab is to change the Request Method. Similar to the lab above, when you click on the **update email** there will be a CSRF payload sent together with the **email** payload. Since it is a POST method, if you modify the CSRF payload, you will get an error that the CSRF is invalid. But change the request method to GET while modifying the CSRF payload the CSRF is not validated. This will be the attack vector.

Submit an **update email** request again with the request method changed, and (optionally) change the CSRF payload. Then, generate a CSRF POC (using BurpSuite Professional) with  **Engagement tools** -> **Generate CSRF POC** and enabling the **auto submit script** in the options. Copy the HTML then go to the exploit server. Paste the payload in the **Body** field, then change the email at `value=` property so it doesn't match to yours. Click **Store** then **Deliver exploit to victim**, optionally you can view the exploit to see if it's working.

## CSRF Where Token Validation Depends on Token Being Present
[LAB: CSRF where token validation depends on token being present](https://portswigger.net/web-security/csrf/bypassing-token-validation/lab-token-validation-depends-on-token-being-present)
For this lab it is the same as the previous CSRF lab before this (from the labs above). The attack vector is the same where in **update email**. But, as the name of the lab suggests, you need to remove the CSRF payload an example would be:
```json
email=aas%40htb.com&csrf=IkhlP6OaPpVevzM0RuMLVic8mhNNRUh2
```

If you're using **BurpSuite Professional**, generate the CSRF POC with  **Engagement tools** -> **Generate CSRF POC** and enabling the **auto submit script** in the options. Copy the HTML then go to the exploit server. Paste the payload in the **Body** field, then change the email at `value=` property so it doesn't match to yours. Click **Store** then **Deliver exploit to victim**, optionally you can view the exploit to see if it's working.

## CSRF Where Token is not Tied to User Session
[LAB: CSRF where token is not tied to user session](https://portswigger.net/web-security/csrf/bypassing-token-validation/lab-token-not-tied-to-user-session)
This lab is different, as the name suggest. The session of the user is not tied to the token, the one we need to exploit here is the CSRF payload that is found every time we login, or make changes in our email. We have 2 accounts available to craft our attack vector, our goal is to **swap** the CSRF token of **carlos** and **wiener**.

First, login as wiener (or carlos either of them) then intercept the request when you click the login button. Take note of the CSRF token, or copy it and paste somewhere then **drop** the login request you just made. On a separate browser (incognito/chrome/firefox) login as carlos. After a successful login, attempt to change your email and intercept it with **BurpSuite**. 

Notice that there is a CSRF token with it, replace it with the **CSRF token of wiener** (NOTE: CSRF is a single use token, you need to intercept another token from the other account to use a new one but remember to **drop** the request). 
![](../../assets/PortSwigger%20Labs/CSRF/Pasted%20image%2020260205185130.png)
When you're done replacing the CSRF token, generate a CSRF HTML POC. with  **Engagement tools** -> **Generate CSRF POC** and enabling the **auto submit script** in the options. Copy the HTML then go to the exploit server. Paste the payload in the **Body** field, then change the email at `value=` property so it doesn't match to yours. Click **Store** then **Deliver exploit to victim**, optionally you can view the exploit to see if it's working.